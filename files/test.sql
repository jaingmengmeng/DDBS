init;
define site site1 10.77.70.172:8000, site2 10.77.70.188:8000, site3 10.77.70.189:8000, site4 10.77.70.189:8000;
show sites;
create table Book (id int key, title char(100), authors char(200), publisher_id int, copies int);
create table Customer (id int key, name char(25), rank int);
create table Orders (customer_id int key, book_id int key, quantity int);
create table Publisher (id int key, name char(100), nation char(3));
show tables;
fragment Book horizontally into id<205000, id>=205000 and id<210000, id>=210000;
fragment Customer vertically into (id, name), (id, rank);
fragment Orders horizontally into customer_id<307000 and book_id<215000, customer_id<307000 and book_id>=215000, customer_id>=307000 and book_id<215000, customer_id>=307000 and book_id>=215000;
fragment Publisher horizontally into id<104000 and nation='PRC', id<104000 and nation='USA', id>=104000 and nation='PRC', id>=104000 and nation='USA';
allocate Book.1 to site1;
allocate Book.2 to site2;
allocate Book.3 to site3;
allocate Customer.1 to site1; 
allocate Customer.2 to site2;
allocate Orders.1 to site1;
allocate Orders.2 to site2;
allocate Orders.3 to site3;
allocate Orders.4 to site4;
allocate Publisher.1 to site1;
allocate Publisher.2 to site2;
allocate Publisher.3 to site3;
allocate Publisher.4 to site4;
show tables;
set distribution;
insert into Customer values(300001, 'Xiaoming', 1);
insert into Customer values(300002, 'Xiaohong', 1);
insert into Publisher values(104001, 'High Education Press', 'PRC');
insert into Book values(205001, 'DDB', 'Oszu', 104001, 100);
insert into Orders values(300001, 205001, 5);
select * from Customer;
select * from Publisher;
select * from Book;
select * from Orders;
delete from Orders;
delete from Book where copies = 100;
delete from Publisher where nation = 'PRC';
delete from Customer where name='Xiaohong' AND rank=1;
delete from Customer where rank = 1;
select * from Customer;
select * from Publisher;
select * from Book;
select * from Orders;
load data local infile '../files/data/book.tsv' into Book;
load data local infile '../files/data/customer.tsv' into Customer;
load data local infile '../files/data/orders.tsv' into Orders;
load data local infile '../files/data/publisher.tsv' into Publisher;
quit;